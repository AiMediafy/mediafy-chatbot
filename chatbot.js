const CONFIG={sparta:{API_URL:"https://mediafy-sparta.app.n8n.cloud/webhook/e93d888f-7641-4e5b-aff5-c39572adf088",CHAT_SESSION_ID:'sparta_demo_'+Math.random().toString(36).substring(2,9),ROOT_ID:'sparta-root-container',TOGGLE_CLASS:'show-widget'},mediafy:{API_URL:"https://mediafy-sparta.app.n8n.cloud/webhook/528387eb-c2b0-45e6-a38f-5bc06f7355f0",CHAT_SESSION_ID:'mediafy_demo_'+Math.random().toString(36).substring(2,9),ROOT_ID:'mediafy-root-container',TOGGLE_CLASS:'show-mediafy-widget'}};const sampleProducts=[{name:"Samozamykacz Geze TS 2000",price:189},{name:"Ramie standardowe TS 2000/4000",price:45}];document.addEventListener("DOMContentLoaded",()=>{initAllChatbots();initCart('sparta');initCart('mediafy')});setTimeout(initAllChatbots,200);window.fillInput=(t,x)=>{const c=CONFIG[t];if(!c)return;const r=document.getElementById(c.ROOT_ID);const i=r.querySelector(".chat-input-field");const s=r.querySelector(".send-btn");if(i&&s){i.value=x;s.click()}};function initCart(b){const r=document.getElementById(CONFIG[b].ROOT_ID);if(!r)return;const c=r.querySelector('.cart-items-container');const d=r.querySelector('.cart-badge');const t=r.querySelector('.total-price');if(c)c.innerHTML='';let o=0;const p=b==='sparta'?sampleProducts:[];const cl=b==='sparta'?'#F97316':'#2563EB';p.forEach(x=>{o+=x.price;const h=`<div class="cart-item"><div class="item-image"><span class="material-symbols-outlined">shopping_bag</span></div><div style="flex:1"><div style="font-size:14px;font-weight:500;color:#fff;margin-bottom:4px">${x.name}</div><div class="item-price" style="color:${cl}!important">${x.price.toFixed(2)} zÅ‚</div></div><button class="icon-btn-dark delete-item" style="color:#ef4444;all:unset;cursor:pointer"><span class="material-symbols-outlined" style="font-size:20px">delete</span></button></div>`;if(c)c.innerHTML+=h});if(d){d.innerText=p.length;d.style.display=p.length>0?'flex':'none'}if(t)t.innerText=o.toFixed(2)+" zÅ‚";if(r.querySelectorAll('.delete-item').length>0)r.querySelectorAll('.delete-item').forEach(x=>x.onclick=()=>r.querySelector(`#delete-modal-${b}`).style.display='flex');const m=r.querySelector(`#delete-modal-${b}`);if(m){const a=m.querySelector('.cancel-delete-btn');const f=m.querySelector('.confirm-delete-btn');if(a)a.onclick=()=>m.style.display='none';if(f)f.onclick=()=>{alert('Produkt usuniÄ™ty (DEMO).');m.style.display='none';initCart(b)}}}function resetBadge(b){const r=document.getElementById(CONFIG[b].ROOT_ID);if(!r)return;const d=r.querySelector(`.${b}-welcome-badge`);if(d){if(b==='sparta')d.innerHTML='<span class="material-symbols-outlined" style="font-size:18px;color:#F97316">sms</span> Przetestuj nasze rozwiÄ…zanie RAG dla SPARTA';else if(b==='mediafy')d.innerHTML='<span class="material-symbols-outlined" style="font-size:18px;color:#2563EB">auto_awesome</span> Masz pytania o ofertÄ™? Pisz Å›miaÅ‚o! ðŸ‘‹';d.style.display='flex'}}function initChatbot(b){const cfg=CONFIG[b];const r=document.getElementById(cfg.ROOT_ID);if(!r)return;const tg=r.querySelector(".chatbot-toggler");const bd=document.body;const inp=r.querySelector(".chat-input-field[data-bot-id='"+b+"']");const snd=r.querySelector(".send-btn[data-bot-id='"+b+"']");const cb=r.querySelector(".chatbox");const ic=r.querySelector(".initial-content");const vb=r.querySelector(`#voice-btn-${b}`);const ba=r.querySelector(".bottom-input-area");tg.onclick=()=>{const o=b==='sparta'?'mediafy':'sparta';bd.classList.remove(CONFIG[o].TOGGLE_CLASS);bd.classList.toggle(cfg.TOGGLE_CLASS);const s=document.querySelector("#sparta-root-container .sparta-welcome-badge");const m=document.querySelector("#mediafy-root-container .mediafy-welcome-badge");if(s)s.style.display='none';if(m)m.style.display='none'};const mb=r.querySelector(".menu-icon");const sp=r.querySelector(".settings-panel");const cp=r.querySelector(".close-panel-icon");const ct=r.querySelector(".cart-trigger");const ctp=r.querySelector(".cart-panel");const cc=r.querySelector(".close-cart");if(mb)mb.onclick=()=>{sp.classList.toggle("active");if(ctp)ctp.classList.remove("active");if(ba)ba.style.display="block"};if(cp)cp.onclick=()=>sp.classList.remove("active");if(ct)ct.onclick=()=>{ctp.classList.toggle("active");sp.classList.remove("active");if(ctp.classList.contains("active")){if(ba)ba.style.display="none"}else{if(ba)ba.style.display="block"}};if(cc)cc.onclick=()=>{ctp.classList.remove("active");if(ba)ba.style.display="block"};const createChatLi=(m,c)=>{const l=document.createElement("li");l.classList.add("chat-message",c);let h=c==="outgoing"?`<div class="message-text">${m}</div>`:`<div class="bot-icon">${b.charAt(0).toUpperCase()}</div><div class="message-text">${m}</div>`;if(m==="...")h=`<div class="bot-icon">${b.charAt(0).toUpperCase()}</div><div class="message-text loading-message" style="display:flex;align-items:center;width:50px"><span class="loading-dot" style="width:6px;height:6px;background:#9da3ae;border-radius:50%;margin:0 2px"></span><span class="loading-dot" style="width:6px;height:6px;background:#9da3ae;border-radius:50%;margin:0 2px"></span><span class="loading-dot" style="width:6px;height:6px;background:#9da3ae;border-radius:50%;margin:0 2px"></span></div>`;l.innerHTML=h;return l};const generateResponse=async(e,u)=>{const t=e.querySelector(".message-text");try{const res=await fetch(cfg.API_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:u,sessionId:cfg.CHAT_SESSION_ID})});const d=await res.json();const br=d.message||d.output||d.text||JSON.stringify(d);const lc=b==='sparta'?'#F97316':'#2563EB';let f=br.replace(/\n[-\s]*\s/g,'\n').replace(/\n\n+/g,'\n\n').replace(/\[([^\]]*?)\]\s*\(([^)]+)\)/g,`<a href="$2" target="_blank" style="color:${lc};text-decoration:underline;font-weight:700;cursor:pointer">Kliknij tutaj</a>`).replace(/(?<!href="|">)(https?:\/\/[^\s<]+)/g,`<a href="$1" target="_blank" style="color:${lc};text-decoration:underline;font-weight:700;cursor:pointer">Kliknij tutaj</a>`);f=f.replace(/\n/g,'<br>').replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>');t.innerHTML=f}catch(x){t.textContent="BÅ‚Ä…d poÅ‚Ä…czenia"}const sc=r.querySelector(".widget-content");sc.scrollTo({top:sc.scrollHeight,behavior:'smooth'});const lu=cb.querySelector(".chat-message.outgoing:last-of-type");if(lu)lu.scrollIntoView({behavior:"smooth",block:"start"})};const handleChat=()=>{const m=inp.value.trim();if(!m)return;ic.style.setProperty('display','none','important');cb.classList.add('active');inp.value="";cb.appendChild(createChatLi(m,"outgoing"));const l=createChatLi("...","incoming");cb.appendChild(l);const sc=r.querySelector(".widget-content");sc.scrollTo({top:sc.scrollHeight,behavior:'smooth'});generateResponse(l,m)};if(snd)snd.onclick=handleChat;if(inp)inp.onkeydown=e=>{if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();handleChat()}};if('webkitSpeechRecognition'in window||'SpeechRecognition'in window){const SR=window.SpeechRecognition||window.webkitSpeechRecognition;const rec=new SR();rec.lang='pl-PL';rec.interimResults=false;if(vb){vb.onclick=()=>{if(vb.classList.contains("listening")){rec.stop();return}rec.start();vb.classList.add("listening");vb.innerHTML='<span class="material-symbols-rounded">mic</span> SÅ‚ucham...'};rec.onresult=e=>{inp.value=e.results[0][0].transcript;vb.classList.remove("listening");vb.innerHTML='<span class="material-symbols-rounded">graphic_eq</span> MÃ³w';handleChat()};rec.onend=()=>{vb.classList.remove("listening");vb.innerHTML='<span class="material-symbols-rounded">graphic_eq</span> MÃ³w'}}}else{if(vb)vb.style.display='none'}}function initAllChatbots(){initChatbot('sparta');initChatbot('mediafy')}document.addEventListener('click',e=>{const sr=document.getElementById('sparta-root-container');const mr=document.getElementById('mediafy-root-container');const bd=document.body;const closeBot=i=>{const cfg=CONFIG[i];const r=document.getElementById(cfg.ROOT_ID);if(!r)return;bd.classList.remove(cfg.TOGGLE_CLASS);const d=r.querySelector(`.${i}-welcome-badge`);if(d){const c=i==='sparta'?'#F97316':'#2563EB';d.innerHTML=`<span class="material-symbols-outlined" style="font-size:18px;color:${c}">sms</span> Czekam na Twoje kolejne pytania! ðŸ‘‹`;d.style.display='flex';setTimeout(()=>{const a=document.querySelectorAll('.sparta-welcome-badge, .mediafy-welcome-badge');a.forEach(x=>x.style.display='none');resetBadge(i)},3000)}};if(bd.classList.contains('show-widget')){const isIn=sr&&sr.contains(e.target);if(!isIn)closeBot('sparta')}if(bd.classList.contains('show-mediafy-widget')){const isIn=mr&&mr.contains(e.target);if(!isIn)closeBot('mediafy')}});